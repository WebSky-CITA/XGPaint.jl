<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Sunyaev–Zeldovich Effect · XGPaint.jl</title><meta name="title" content="Sunyaev–Zeldovich Effect · XGPaint.jl"/><meta property="og:title" content="Sunyaev–Zeldovich Effect · XGPaint.jl"/><meta property="twitter:title" content="Sunyaev–Zeldovich Effect · XGPaint.jl"/><meta name="description" content="Documentation for XGPaint.jl."/><meta property="og:description" content="Documentation for XGPaint.jl."/><meta property="twitter:description" content="Documentation for XGPaint.jl."/><meta property="og:url" content="https://github.com/WebSky-CITA/XGPaint.jl/sz/"/><meta property="twitter:url" content="https://github.com/WebSky-CITA/XGPaint.jl/sz/"/><link rel="canonical" href="https://github.com/WebSky-CITA/XGPaint.jl/sz/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">XGPaint.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Sunyaev–Zeldovich Effect</a><ul class="internal"><li><a class="tocitem" href="#Healpix"><span>Healpix</span></a></li></ul></li><li><a class="tocitem" href="../ksz/">Kinetic Sunyaev–Zeldovich Effect</a></li><li><a class="tocitem" href="../rsz/">Relativistic Sunyaev–Zeldovich Effect</a></li><li><a class="tocitem" href="../cib/">Cosmic Infrared Background</a></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../developer_notes/">Developer Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Sunyaev–Zeldovich Effect</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Sunyaev–Zeldovich Effect</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/WebSky-CITA/XGPaint.jl/blob/main/docs/src/sz.md#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="The-Sunyaev–Zeldovich-Effect"><a class="docs-heading-anchor" href="#The-Sunyaev–Zeldovich-Effect">The Sunyaev–Zeldovich Effect</a><a id="The-Sunyaev–Zeldovich-Effect-1"></a><a class="docs-heading-anchor-permalink" href="#The-Sunyaev–Zeldovich-Effect" title="Permalink"></a></h1><p>Let&#39;s make some maps of the thermal Sunyaev-Zeldovich (SZ) effect. First, let&#39;s load up the example halo catalog included in this package. These will be automatically downloaded the first time you load them.</p><pre><code class="language-julia hljs">using XGPaint, Plots

# example , ra and dec in radians, halo mass in M200c (Msun)
ra, dec, redshift, halo_mass = XGPaint.load_example_halos()
print(&quot;Number of halos: &quot;, length(halo_mass))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Number of halos: 2455621</code></pre><p>This small catalog is limited to a relatively small patch of the sky. Before we generate some SZ maps, let&#39;s take a look at the halo mass distribution.</p><pre><code class="language-julia hljs">b = 10.0 .^ (11:0.25:16)
histogram(halo_mass, bins=b, xaxis=(:log10, (1e11, 1e16)),
    yscale=:log10, label=&quot;&quot;, xlabel=&quot;Halo mass (solar masses)&quot;, ylabel=&quot;counts&quot;)</code></pre><img src="31f6efce.svg" alt="Example block output"/><p>Also notice the steep dropoff in counts at <span>$10^{12} M_{\odot}$</span>, corresponding to the halo resolution of the Websky simulation from which these halos were taken. Fortunately, the SZ effect is dominated by the most massive halos.</p><p>To allow for safe threaded painting on a single map, we&#39;ll sort the halo catalog by declinations.</p><pre><code class="language-julia hljs">ra, dec, redshift, halo_mass = sort_halo_catalog(ra, dec, redshift, halo_mass);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Float32[0.03305517, -0.052936707, 0.07140066, -0.06599737, -0.05942857, -0.05192846, 0.022953046, 0.01955623, 0.05080256, 0.00839793  …  0.060685053, -0.061119348, -0.040161338, 0.047465798, -0.041020952, -0.048511826, -0.018889412, 0.058788735, -0.050192643, -0.0027171609], Float32[-0.11871151, -0.118711114, -0.118711084, -0.11871107, -0.1187108, -0.118710734, -0.11871068, -0.118710674, -0.11871066, -0.11871049  …  0.10907136, 0.1090714, 0.10907147, 0.109071486, 0.1090715, 0.109071545, 0.10907169, 0.10907171, 0.10907183, 0.10907187], Float32[2.583177, 0.6798465, 1.4767964, 2.4593022, 1.3147808, 1.7026237, 1.313409, 1.2228533, 2.061896, 1.7019778  …  0.4401552, 3.107578, 1.2217613, 2.3513637, 2.2199023, 1.7342392, 0.6818484, 0.8421148, 1.2661853, 2.0941606], Float32[1.8216356f12, 3.4135917f12, 4.958732f12, 3.3517478f12, 2.6270643f12, 2.1461618f12, 1.5084386f12, 4.1571304f12, 1.3568221f12, 2.2222684f12  …  4.438609f12, 1.3447792f12, 1.5955485f12, 1.7920556f12, 8.5669514f12, 2.6231164f12, 2.2672384f12, 2.409821f13, 5.5713213f12, 2.7740707f12])</code></pre><p>This package relies on a precomputed interpolation table for performance when making large sky maps of the SZ effect. For this tutorial, we&#39;ll load a profile and the associated interpolator from disk.</p><pre><code class="language-julia hljs">model, interp = XGPaint.load_precomputed_battaglia()
print(model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Battaglia16ThermalSZProfile{Float64, Cosmology.FlatLCDM{Float64}}(0.15804878048780488, Cosmology.FlatLCDM{Float64}(0.6774, 0.6924089058605902, 0.3075, 9.109413940981078e-5))</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If you want to generate your own model (such as varying cosmology), you would instead configure the appropriate model and then build an interpolator. The interpolator generation is multithreaded and takes about five minutes on 16 cores. </p><pre><code class="nohighlight hljs">model = Battaglia16ThermalSZProfile(Omega_c=0.2589, Omega_b=0.0486, h=0.6774)
interp = build_interpolator(model, cache_file=&quot;cached_b16.jld2&quot;, overwrite=true)</code></pre><p>This will save the results to the cache_file as well. If you want to load a result from disk, you can specify <code>overwrite=false</code><sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>.</p></div></div><p>Now, we&#39;ll set up the map to generate. We will construct a small CAR (Clenshaw-Curtis variant) patch on the sky. You have to construct a workspace <strong>for each new sky patch</strong>.</p><pre><code class="language-julia hljs">using Pixell
box = [4.5   -4.5;           # RA
       -3     3] * Pixell.degree  # DEC
shape, wcs = geometry(CarClenshawCurtis{Float64}, box, 0.5 * Pixell.arcminute)
m = Enmap(zeros(shape), wcs)

# construct on workspace on this patch
workspace = profileworkspace(shape, wcs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">XGPaint.CarClenshawCurtisProfileWorkspace{Pixell.Enmap{Float64, 2, Matrix{Float64}, Pixell.CarClenshawCurtis{Float64}}}(Enmap(shape=(1080, 720),wcs=CarClenshawCurtis{Float64}(naxis=2,cdelt=(-0.008333333333333333, 0.008333333333333333),crval=(0.0, 0.0),crpix=(541.0, 361.00000000000006))), Enmap(shape=(1080, 720),wcs=CarClenshawCurtis{Float64}(naxis=2,cdelt=(-0.008333333333333333, 0.008333333333333333),crval=(0.0, 0.0),crpix=(541.0, 361.00000000000006))), Enmap(shape=(1080, 720),wcs=CarClenshawCurtis{Float64}(naxis=2,cdelt=(-0.008333333333333333, 0.008333333333333333),crval=(0.0, 0.0),crpix=(541.0, 361.00000000000006))), Enmap(shape=(1080, 720),wcs=CarClenshawCurtis{Float64}(naxis=2,cdelt=(-0.008333333333333333, 0.008333333333333333),crval=(0.0, 0.0),crpix=(541.0, 361.00000000000006))))</code></pre><p>Now it&#39;s time to apply the model to the map.</p><pre><code class="language-julia hljs">@time paint!(m, model, workspace, interp, halo_mass, redshift, ra, dec)
plot(log10.(m), c = :thermal)</code></pre><img src="b7c8a547.svg" alt="Example block output"/><h2 id="Healpix"><a class="docs-heading-anchor" href="#Healpix">Healpix</a><a id="Healpix-1"></a><a class="docs-heading-anchor-permalink" href="#Healpix" title="Permalink"></a></h2><p>To generate Healpix maps, you&#39;ll need the <a href="https://github.com/ziotom78/Healpix.jl">Healpix.jl</a> package.</p><pre><code class="language-julia hljs">using Healpix

nside = 4096
m_hp = HealpixMap{Float64,RingOrder}(nside)
w0 = XGPaint.HealpixProfileWorkspace(nside,
    exp(minimum(interp.ranges[1])), π/180, interp)
ws = [XGPaint.HealpixProfileWorkspace(nside, w0.θmin, w0.θmax,
    interp, w0.posmap) for _ in 1:Threads.nthreads()];


@time XGPaint.paint!(m_hp, model, ws, interp, halo_mass, redshift, ra, dec)
# Healpix.saveToFITS(m_hp, &quot;!y.fits&quot;, typechar=&quot;D&quot;)

plot(m_hp)</code></pre><img src="0cdb504a.svg" alt="Example block output"/><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>For maps with many pixels and halos, building the interpolator is only about 10% of the map generation cost. If you have a use case where you instead need to vary cosmology on very small patches, contact the developers!</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../ksz/">Kinetic Sunyaev–Zeldovich Effect »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 6 December 2024 03:26">Friday 6 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
