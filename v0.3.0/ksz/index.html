<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Kinetic Sunyaev–Zeldovich Effect · XGPaint.jl</title><meta name="title" content="Kinetic Sunyaev–Zeldovich Effect · XGPaint.jl"/><meta property="og:title" content="Kinetic Sunyaev–Zeldovich Effect · XGPaint.jl"/><meta property="twitter:title" content="Kinetic Sunyaev–Zeldovich Effect · XGPaint.jl"/><meta name="description" content="Documentation for XGPaint.jl."/><meta property="og:description" content="Documentation for XGPaint.jl."/><meta property="twitter:description" content="Documentation for XGPaint.jl."/><meta property="og:url" content="https://github.com/WebSky-CITA/XGPaint.jl/ksz/"/><meta property="twitter:url" content="https://github.com/WebSky-CITA/XGPaint.jl/ksz/"/><link rel="canonical" href="https://github.com/WebSky-CITA/XGPaint.jl/ksz/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">XGPaint.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../sz/">Sunyaev–Zeldovich Effect</a></li><li class="is-active"><a class="tocitem" href>Kinetic Sunyaev–Zeldovich Effect</a><ul class="internal"><li><a class="tocitem" href="#Healpix"><span>Healpix</span></a></li></ul></li><li><a class="tocitem" href="../rsz/">Relativistic Sunyaev–Zeldovich Effect</a></li><li><a class="tocitem" href="../cib/">Cosmic Infrared Background</a></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../developer_notes/">Developer Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Kinetic Sunyaev–Zeldovich Effect</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Kinetic Sunyaev–Zeldovich Effect</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/WebSky-CITA/XGPaint.jl/blob/main/docs/src/ksz.md#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="The-Kinetic-Sunyaev–Zeldovich-Effect"><a class="docs-heading-anchor" href="#The-Kinetic-Sunyaev–Zeldovich-Effect">The Kinetic Sunyaev–Zeldovich Effect</a><a id="The-Kinetic-Sunyaev–Zeldovich-Effect-1"></a><a class="docs-heading-anchor-permalink" href="#The-Kinetic-Sunyaev–Zeldovich-Effect" title="Permalink"></a></h1><p>Let&#39;s make some maps of the kinetic Sunyaev-Zeldovich (SZ) effect. First, let&#39;s load up the example halo catalog included in this package. These will be automatically downloaded the first time you load them.</p><pre><code class="language-julia hljs">using XGPaint, Plots, Unitful, UnitfulAstro

# example , ra and dec in radians, halo mass in M200c (Msun)
ra, dec, redshift, halo_mass = XGPaint.load_example_halos()
print(&quot;Number of halos: &quot;, length(halo_mass))

# the current test halos do not include velocities, so we randomly generate some for this
proj_v_over_c = randn(eltype(ra), length(halo_mass)) / 1000</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2455621-element Vector{Float32}:
  0.00070654514
 -0.00050928735
 -0.0016888231
  0.001249125
 -0.0002746153
  0.00038147226
 -0.0023370767
  0.0028252376
 -0.0006235423
 -0.00058712304
  ⋮
  0.0008474445
  0.0005945247
 -0.00019749108
 -0.00044701083
  0.00014747179
 -0.00047439965
  0.00020164772
 -0.0009294714
 -0.00078239554</code></pre><p>This small catalog is limited to a relatively small patch of the sky. Before we generate some SZ maps, let&#39;s take a look at the halo mass distribution.</p><pre><code class="language-julia hljs">b = 10.0 .^ (11:0.25:16)
histogram(halo_mass, bins=b, xaxis=(:log10, (1e11, 1e16)),
    yscale=:log10, label=&quot;&quot;, xlabel=&quot;Halo mass (solar masses)&quot;, ylabel=&quot;counts&quot;)</code></pre><img src="89f8f07b.svg" alt="Example block output"/><p>To allow for safe threaded painting on a single map, we&#39;ll sort the halo catalog by declinations.</p><pre><code class="language-julia hljs">ra, dec, redshift, halo_mass = sort_halo_catalog(ra, dec, redshift, halo_mass);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Float32[0.03305517, -0.052936707, 0.07140066, -0.06599737, -0.05942857, -0.05192846, 0.022953046, 0.01955623, 0.05080256, 0.00839793  …  0.060685053, -0.061119348, -0.040161338, 0.047465798, -0.041020952, -0.048511826, -0.018889412, 0.058788735, -0.050192643, -0.0027171609], Float32[-0.11871151, -0.118711114, -0.118711084, -0.11871107, -0.1187108, -0.118710734, -0.11871068, -0.118710674, -0.11871066, -0.11871049  …  0.10907136, 0.1090714, 0.10907147, 0.109071486, 0.1090715, 0.109071545, 0.10907169, 0.10907171, 0.10907183, 0.10907187], Float32[2.583177, 0.6798465, 1.4767964, 2.4593022, 1.3147808, 1.7026237, 1.313409, 1.2228533, 2.061896, 1.7019778  …  0.4401552, 3.107578, 1.2217613, 2.3513637, 2.2199023, 1.7342392, 0.6818484, 0.8421148, 1.2661853, 2.0941606], Float32[1.8216356f12, 3.4135917f12, 4.958732f12, 3.3517478f12, 2.6270643f12, 2.1461618f12, 1.5084386f12, 4.1571304f12, 1.3568221f12, 2.2222684f12  …  4.438609f12, 1.3447792f12, 1.5955485f12, 1.7920556f12, 8.5669514f12, 2.6231164f12, 2.2672384f12, 2.409821f13, 5.5713213f12, 2.7740707f12])</code></pre><p>Now, we&#39;ll set up the map to generate. We will construct a small CAR (Clenshaw-Curtis variant) patch on the sky. You have to construct a workspace <strong>for each new sky patch</strong>.</p><pre><code class="language-julia hljs">using Pixell
box = [4.5   -4.5;           # RA
       -3     3] * Pixell.degree  # DEC
shape, wcs = geometry(CarClenshawCurtis{Float64}, box, 0.5 * Pixell.arcminute)
m = Enmap(zeros(shape), wcs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1080×720 Pixell.Enmap{Float64, 2, Matrix{Float64}, Pixell.CarClenshawCurtis{Float64}}:
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 ⋮                        ⋮              ⋱            ⋮                   
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0</code></pre><p>Now let&#39;s set up an electron profile.</p><pre><code class="language-julia hljs">model = BattagliaTauProfile(Omega_c=0.267, Omega_b=0.0493,  h=0.6712)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BattagliaTauProfile{Float64, Cosmology.FlatLCDM{Float64}, true}(0.1558646854252292, Cosmology.FlatLCDM{Float64}(0.6712, 0.6836071403864511, 0.3163, 9.285961354891755e-5))</code></pre><p>We can now compute the integrated electron density, </p><pre><code class="language-julia hljs">workspace = profileworkspace(shape, wcs)

# this only needs to be done once
# to cache: interp = build_interpolator(model, cache_file=&quot;cached_btau.jld2&quot;, overwrite=false)
interp = build_interpolator(model)

m = Enmap(zeros(shape), wcs)
mass_in_Msun = 1f15
paint!(m, model, workspace, interp, halo_mass, redshift, ra, dec, proj_v_over_c)
plot(log10.(abs.(m)), c = :thermal)</code></pre><img src="4f3e11b8.svg" alt="Example block output"/><h2 id="Healpix"><a class="docs-heading-anchor" href="#Healpix">Healpix</a><a id="Healpix-1"></a><a class="docs-heading-anchor-permalink" href="#Healpix" title="Permalink"></a></h2><p>To generate Healpix maps, you&#39;ll need the <a href="https://github.com/ziotom78/Healpix.jl">Healpix.jl</a> package.</p><pre><code class="language-julia hljs">using Healpix

nside = 2048
m_hp = HealpixMap{Float64,RingOrder}(nside)
w0 = XGPaint.HealpixProfileWorkspace(nside,
    exp(minimum(interp.ranges[1])), π/180, interp)
ws = [XGPaint.HealpixProfileWorkspace(nside, w0.θmin, w0.θmax,
    interp, w0.posmap) for _ in 1:Threads.nthreads()];


@time XGPaint.paint!(m_hp, model, ws, interp, halo_mass, redshift, ra, dec, proj_v_over_c)
# Healpix.saveToFITS(m_hp, &quot;!y.fits&quot;, typechar=&quot;D&quot;)

plot(m_hp)</code></pre><img src="bc8bb457.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../sz/">« Sunyaev–Zeldovich Effect</a><a class="docs-footer-nextpage" href="../rsz/">Relativistic Sunyaev–Zeldovich Effect »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 6 December 2024 03:27">Friday 6 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
